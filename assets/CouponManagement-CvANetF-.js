import{p as A,r as c,d as j,q as N,i as V,o as B,s as E,j as F,c as v,a as _,e,t as g,v as r,x as h,y as $,z as I,g as S,m as z,w as G,F as R,f as U,n as L}from"./index-C4sBmd-v.js";import{_ as q}from"./DeleteModal.vue_vue_type_script_setup_true_lang-CmAjnZyG.js";import{M as H}from"./bootstrap.esm-Ctwlr2Hi.js";import{D as O}from"./DefaultContainer-BSxQy2jy.js";const J="https://ec-course-api.hexschool.io/",M="ifjewelrystyle",y=A.create({baseURL:J});y.interceptors.request.use(l=>{const a=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return a&&(l.headers.Authorization=a),l},l=>Promise.reject(l));y.interceptors.response.use(l=>Promise.resolve(l),l=>Promise.reject(l.response.data));const K=l=>y.get(`/v2/api/${M}/admin/coupons`,{params:l}),Q=l=>y.post(`/v2/api/${M}/admin/coupon`,{data:l}),W=l=>{const{id:a,data:p}=l;return y.put(`/v2/api/${M}/admin/coupon/${a}`,{data:p})},X=l=>y.delete(`/v2/api/${M}/admin/coupon/${l}`),T=()=>({id:"",due_date:"",is_enabled:0,percent:0,title:"",code:""});function Y(){const l=c(T()),a=c("新增優惠券"),p=i=>{i?(l.value={...i,due_date:new Date(i.due_date*1e3).toISOString().slice(0,10)},a.value="編輯優惠券"):u()},u=()=>{l.value=T(),a.value="新增優惠券"};return{form:l,formTitle:a,loadCoupon:p,resetForm:u}}const Z={class:"modal-dialog modal-dialog-centered modal-lg"},ee={class:"modal-content rounded-lg"},te={class:"modal-header"},oe={class:"modal-title",id:"addNewProductModalLabel"},le={class:"modal-body"},se={class:"row"},ne={class:"col-md-12"},ae={class:"row"},de={class:"col-6 mb-3"},ie={class:"col-6 mb-3"},re={class:"row"},ue={class:"col-6 mb-3"},ce={class:"col-6 mb-3"},pe={class:"mb-3 d-flex align-items-center"},me={class:"form-check form-switch"},fe={class:"modal-footer"},be=["disabled"],ve=j({__name:"CouponModal",props:{coupon:{}},emits:["get-coupons"],setup(l,{expose:a,emit:p}){const u=p,i=N("modalRef");let m=null;const x=V(()=>!!l.coupon.id),d=c(!1),{form:n,formTitle:f,loadCoupon:w,resetForm:C}=Y(),D=()=>{m&&m.show()},b=()=>{m&&(m.hide(),C())},P=async()=>{const s={...n.value,due_date:Math.floor(new Date(n.value.due_date).getTime()/1e3)},{id:t,...o}=s;d.value=!0;try{x.value&&t?await W({data:o,id:t}):await Q(o),b()}catch(k){alert("新增/編輯優惠券失敗"),console.error(k)}finally{d.value=!1,u("get-coupons")}};return a({openModal:D,closeModal:b}),B(()=>{i.value&&(m=new H(i.value))}),E(()=>{m&&m.dispose()}),F(()=>l.coupon,s=>{s&&s.id?w(s):w(null)},{immediate:!0,deep:!0}),(s,t)=>(_(),v("div",{ref_key:"modalRef",ref:i,class:"modal fade",id:"addNewProductModal",tabindex:"-1","aria-labelledby":"addNewProductModalLabel","aria-hidden":"true"},[e("div",Z,[e("div",ee,[e("div",te,[e("h5",oe,g(r(f)),1),e("button",{onClick:b,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",le,[e("div",se,[e("div",ne,[e("form",null,[e("div",ae,[e("div",de,[t[5]||(t[5]=e("label",{for:"couponName",class:"form-label"},"優惠券名稱",-1)),h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>r(n).title=o),type:"text",class:"form-control rounded-lg",id:"couponName"},null,512),[[$,r(n).title]])]),e("div",ie,[t[6]||(t[6]=e("label",{for:"couponName",class:"form-label"},"優惠碼",-1)),h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>r(n).code=o),type:"text",class:"form-control rounded-lg",id:"couponCode"},null,512),[[$,r(n).code]])])]),e("div",re,[e("div",ue,[t[7]||(t[7]=e("label",{for:"couponPercent",class:"form-label"},"優惠%數",-1)),h(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>r(n).percent=o),type:"number",class:"form-control rounded-lg",id:"couponPercent"},null,512),[[$,r(n).percent]])]),e("div",ce,[t[8]||(t[8]=e("label",{for:"couponDueDate",class:"form-label"},"到期日",-1)),h(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>r(n).due_date=o),type:"date",class:"form-control rounded-lg",id:"couponDueDate"},null,512),[[$,r(n).due_date]])])]),e("div",pe,[t[9]||(t[9]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",me,[h(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>r(n).is_enabled=o),class:"form-check-input",type:"checkbox",id:"flexSwitchProductEnable","true-value":1,"false-value":0},null,512),[[I,r(n).is_enabled]])])])])])])]),e("div",fe,[e("button",{onClick:b,type:"button",class:"btn btn-outline-secondary rounded-lg"}," 取消 "),e("button",{onClick:P,disabled:d.value,type:"button",class:"btn btn-dark rounded-lg"}," 儲存 ",8,be)])])])],512))}}),_e={class:"d-flex justify-content-between align-items-center mb-4"},ge=["disabled"],he={class:"card shadow-sm rounded-lg flex-grow-1"},ye={class:"card-body p-4"},Ce={class:"table-responsive"},ke={class:"table table-hover align-middle"},$e={class:"text-center"},xe={class:"form-check form-switch d-flex justify-content-center align-items-center"},we=["checked"],Me={class:"text-nowrap"},De=["onClick"],Pe=["onClick"],Se={class:"d-flex justify-content-center mt-4"},Re={class:"pagination"},Le={class:"page-item"},Ne=["disabled"],Ue=["onClick","disabled"],Te={class:"page-item"},je=["disabled"],Ie=j({__name:"CouponManagement",setup(l){const a=N("deleteModalRef"),p=N("couponModalRef"),u=c(!1),i=c(""),x=c({id:"",due_date:0,is_enabled:0,percent:0,title:"",code:""}),d=c("1"),n=c([]),f=c({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),w=V(()=>{const s=i.value.trim().toLowerCase();return s?n.value.filter(t=>t.title.toLowerCase().includes(s)):n.value}),C=async()=>{u.value=!0;try{const s=await K({page:d.value});n.value=s.data.coupons,f.value=s.data.pagination}catch(s){alert("取得優惠券列表失敗"),console.error(s)}finally{u.value=!1}},D=async s=>{try{await X(s)}catch(t){alert("刪除優惠券失敗"),console.error(t)}finally{C()}},b=(s=null)=>{s&&(x.value={...s}),p.value?.openModal()},P=s=>{a.value?.openModal(()=>D(s))};return B(()=>{C()}),(s,t)=>(_(),v(R,null,[e("div",_e,[h(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),class:"rounded-1 ps-3",placeholder:"請輸入優惠券關鍵字"},null,512),[[$,i.value]]),e("button",{onClick:t[1]||(t[1]=o=>b(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2",disabled:u.value},[...t[4]||(t[4]=[e("i",{class:"fas fa-plus me-2"},null,-1),z(" 新增優惠券 ",-1)])],8,ge)]),S(O,{loading:u.value},{default:G(()=>[e("div",he,[e("div",ye,[e("div",Ce,[e("table",ke,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠碼"),e("th",{scope:"col"},"優惠%數"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(_(!0),v(R,null,U(w.value,o=>(_(),v("tr",{key:o.id},[e("td",null,g(o.title),1),e("td",null,g(o.code),1),e("td",null,g(o.percent),1),e("td",null,g(new Date(o.due_date*1e3).toLocaleDateString().slice(0,10)),1),e("td",$e,[e("div",xe,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!o.is_enabled},null,8,we)])]),e("td",Me,[e("button",{onClick:k=>b(o),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 編輯 ",8,De),e("button",{onClick:k=>P(o.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,Pe)])]))),128))])])]),e("nav",Se,[e("ul",Re,[e("li",Le,[e("button",{onClick:t[2]||(t[2]=o=>d.value=String(Number(d.value)-1)),disabled:!f.value?.has_pre,type:"button",class:L(["page-link",{disabled:!f.value?.has_pre}]),"aria-label":"Previous"},[...t[6]||(t[6]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,Ne)]),(_(!0),v(R,null,U(f.value?.total_pages,(o,k)=>(_(),v("li",{key:k,class:"page-item"},[e("button",{onClick:Ve=>d.value=o.toString(),disabled:d.value===o.toString(),type:"button",class:L(["page-link",{active:d.value===o.toString()}])},g(o),11,Ue)]))),128)),e("li",Te,[e("button",{onClick:t[3]||(t[3]=o=>d.value=String(Number(d.value)+1)),disabled:!f.value?.has_next,class:L(["page-link",{disabled:!f.value?.has_next}]),type:"button","aria-label":"Next"},[...t[7]||(t[7]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,je)])])])])])]),_:1},8,["loading"]),S(ve,{ref_key:"couponModalRef",ref:p,coupon:x.value,onGetCoupons:C},null,8,["coupon"]),S(q,{ref_key:"deleteModalRef",ref:a,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{Ie as default};
